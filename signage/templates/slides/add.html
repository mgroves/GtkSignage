{% extends "base.html" %}

{% block title %}Add Slide - GTK Signage{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Add Slide</h1>
        <p><a href="{{ url_for('slides.admin_slides') }}" class="btn btn-secondary mb-4">← Back to Slides</a></p>
    </div>
</div>

<div class="row">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">New Slide Details</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('slides.admin_add') }}" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="mb-3">
                        <label for="source" class="form-label">Image URL (optional)</label>
                        <input type="text" class="form-control" id="source" name="source" placeholder="https:// or http://">
                    </div>
                    
                    <div class="mb-3">
                        <label for="file" class="form-label">Upload Image (optional)</label>
                        <input type="file" class="form-control" id="file" name="file" accept="image/*">
                        <div class="form-text">Allowed formats: PNG, JPG, JPEG, GIF, BMP, SVG, WEBP. Max size: 10MB</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="duration" class="form-label">Duration (seconds)</label>
                        <input type="number" class="form-control" id="duration" name="duration" required min="1" max="3600">
                    </div>
                    
                    <div class="mb-3">
                        <label for="start" class="form-label">Start Date & Time (optional)</label>
                        <input type="datetime-local" class="form-control" id="start" name="start">
                    </div>
                    
                    <div class="mb-3">
                        <label for="end" class="form-label">End Date & Time (optional)</label>
                        <input type="datetime-local" class="form-control" id="end" name="end">
                    </div>
                    
                    <div class="mb-4 form-check">
                        <input type="checkbox" class="form-check-input" id="hide" name="hide">
                        <label class="form-check-label" for="hide">Hidden (do not display this slide)</label>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Add Slide</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function validateForm() {
    const url = document.getElementById("source").value.trim();
    const fileInput = document.getElementById("file");
    const file = fileInput.files.length;
    const duration = document.getElementById("duration").value;
    const start = document.getElementById("start").value;
    const end = document.getElementById("end").value;

    // Validate source (either URL or file)
    if ((url && file) || (!url && !file)) {
        alert("Please provide *either* an image URL *or* upload a file — not both.");
        return false;
    }
    
    // Validate URL format
    if (url) {
        if (!(url.startsWith('http://') || url.startsWith('https://'))) {
            alert("URL must start with http:// or https://");
            return false;
        }
    }
    
    // Validate file size
    if (file) {
        const maxSize = 10 * 1024 * 1024; // 10MB in bytes
        if (fileInput.files[0].size > maxSize) {
            alert("File is too large. Maximum size is 10MB.");
            return false;
        }
        
        // Validate file type
        const fileName = fileInput.files[0].name;
        const fileExt = fileName.split('.').pop().toLowerCase();
        const allowedExtensions = ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'svg', 'webp'];
        
        if (!allowedExtensions.includes(fileExt)) {
            alert("File type not allowed. Allowed types: " + allowedExtensions.join(', '));
            return false;
        }
    }
    
    // Validate duration
    if (!duration || isNaN(duration) || parseInt(duration) <= 0) {
        alert("Duration must be a positive number.");
        return false;
    }
    
    if (parseInt(duration) > 3600) {
        alert("Duration cannot exceed 3600 seconds (1 hour).");
        return false;
    }

    // Validate start and end times
    if (start && end && new Date(start) >= new Date(end)) {
        alert("End date/time must be later than start date/time.");
        return false;
    }

    return true;
}
</script>
{% endblock %}
